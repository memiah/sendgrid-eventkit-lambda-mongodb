sudo: required
dist: trusty

services:
  - docker

env:
  ENVIRONMENT: travis

before_install:
  - sudo docker --version
  - sudo docker build --no-cache --rm --file=.docker/Dockerfile.travis .

script:
  - docker-compose -f docker-compose.yml -f .docker/docker-compose.travis.yml up --exit-code-from app
  - npm install

deploy:
  provider: lambda
  role: "arn:aws:iam::057188795804:role/lambda_basic_execution"
  region: "eu-west-2"
  function_name: "sendgrid-eventkit"
  handler_name: "handler"
  runtime: "nodejs8.10"

after_script:
  - docker-compose stop
  - docker-compose rm -f
